<html lang="ja">
<head>
    <meta charset="utf-8">
    <title>æ¼”ç¿’èª²é¡Œ5-2ï¼šå¤–éƒ¨APIã®å‘¼ã³å‡ºã—ãƒ†ã‚¹ãƒˆ</title>
</head>
<body>
    <h1 id="msg">OpenWeatherAPI</h1>
    <form name="apiform"><p>
        ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆã§éƒ½å¸‚åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼š<input type="text" name="form_data">
        <button type="button" id="btn1" onclick="some_api(this.form)">å®Ÿè¡Œ</button>
    </p></form>
    
    <div id="result"></div>    <script>
        
const API_KEY = "a09c705a0fee23930a5e88593cd444bd"; 



function getClothingAdvice(temp) {
    if (temp >= 28) {
        return "Tã‚·ãƒ£ãƒ„ã‚„çŸ­ãƒ‘ãƒ³ã§OKï¼æš‘ã„ã‹ã‚‰æ°´åˆ†è£œçµ¦å¿˜ã‚Œãšã«ğŸŒ";
    } else if (temp >= 23) {
        return "Tã‚·ãƒ£ãƒ„ã«è–„æ‰‹ã®ç¾½ç¹”ã‚ŠãŒã¡ã‚‡ã†ã©ã„ã„ã‹ã‚‚ã€‚";
    } else if (temp >= 18) {
        return "é•·è¢–ã‚·ãƒ£ãƒ„ã‚„è–„æ‰‹ã®ãƒ‹ãƒƒãƒˆãŒâ—";
    } else if (temp >= 12) {
        return "ãƒ‘ãƒ¼ã‚«ãƒ¼ã‚„ãƒ©ã‚¤ãƒˆã‚¸ãƒ£ã‚±ãƒƒãƒˆãŒã‚ã‚‹ã¨å®‰å¿ƒï¼";
    } else if (temp >= 6) {
        return "ã‚³ãƒ¼ãƒˆã‚„åšæ‰‹ã®æœè£…ã§å¯’ã•å¯¾ç­–ã‚’ï¼";
    } else {
        return "ã‚ã£ã¡ã‚ƒå¯’ã„ï¼ãƒ€ã‚¦ãƒ³ã‚¸ãƒ£ã‚±ãƒƒãƒˆï¼‹ãƒ’ãƒ¼ãƒˆãƒ†ãƒƒã‚¯ã§ã‚¬ãƒé˜²å¯’ã—ã‚ˆã†â›„ï¸";
    }
}

function getWeatherAdvice(temp, description) {
    let advice = getClothingAdvice(temp); 

    if (description.includes("é›¨") || description.includes("é›·")) {
        advice += " ã‚ã¨ã€ä»Šæ—¥ã¯é›¨ãŒé™ã‚Šãã†â˜”ï¸ å‚˜ã‚’å¿˜ã‚Œãšã«ï¼";
    } else if (description.includes("é›ª")) {
        advice += " é›ªã‚‚é™ã‚‹ã¿ãŸã„â„ï¸ æ»‘ã‚‰ãªã„ã‚ˆã†ã«æ³¨æ„ï¼";
    } else if (description.includes("æ™´")) {
        advice += " æ™´ã‚Œã¦æ°—æŒã¡ã„ã„ä¸€æ—¥ã«ãªã‚Šãã†ã ã­â˜€ï¸";
    }
    

    return advice;
}



async function some_api(myForm) {
    
    const city = myForm.form_data.value;
    
    
    if (!city) {
        document.getElementById("result").innerHTML = "éƒ½å¸‚åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚";
        return;
    }
    
    
    const URL = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${API_KEY}&units=metric&lang=ja`;
    
    try {
        const response = await fetch(URL);
        if (response.ok) { 
            const data = await response.json();

            const temp = data.main.temp;
            const description = data.weather[0].description;

            // çµæœã‚’HTMLã§è¡¨ç¤º
            const advice = getWeatherAdvice(temp, description);
            const resultHtml = `
                <h3>${city}ã®å¤©æ°—æƒ…å ±</h3>
                <p><strong>æ°—æ¸©:</strong> ${temp}â„ƒ</p>
                <p><strong>å¤©æ°—:</strong> ${description}</p>
                <p><strong>æœè£…ã‚¢ãƒ‰ãƒã‚¤ã‚¹:</strong> ${advice}</p>
            `;
            document.getElementById("result").innerHTML = resultHtml;
        } else {
            
            let errorMessage = `å¤©æ°—æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰: ${response.status}`;
            try {
                const errorData = await response.json();
                if (errorData && errorData.message) {
                    errorMessage += ` - ${errorData.message}`;
                }
            } catch (e) {
                
                errorMessage += ` - ${response.statusText}`;
            }
            document.getElementById("result").innerHTML = errorMessage + "<br>éƒ½å¸‚åã‚„APIã‚­ãƒ¼ã€ã¾ãŸã¯ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚";
        }
    } catch (error) {
        document.getElementById("result").innerHTML = "å¤©æ°—æƒ…å ±ã®å–å¾—ä¸­ã«äºˆæœŸã›ã¬ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚<br>ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚„APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚";
    }
}
    </script>
</body>
</html>
